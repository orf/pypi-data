{
    "1.0": {
        "info": {
            "author": "Barthelemy von Haller",
            "author_email": "bvonhall@cern.ch",
            "bugtrack_url": null,
            "classifiers": [
                "Development Status :: 5 - Production/Stable",
                "Environment :: Console",
                "License :: OSI Approved :: GNU General Public License v3 (GPLv3)",
                "Operating System :: Unix",
                "Programming Language :: Python :: 3",
                "Topic :: Utilities"
            ],
            "description": "Here are the tools to clean up the CCDB of the QC.\n\n## Entry point\nIt is `o2-qc-repo-cleaner`. See the long comment at the beginning.\n\n## Usage\n```\nusage: o2-qc-repo-cleaner [-h] [--config CONFIG] [--config-git] [--config-consul CONFIG_CONSUL] [--log-level LOG_LEVEL] \n                          [--dry-run] [--only-path ONLY_PATH] [--workers WORKERS]\n```\n\n## Configuration\nThe file `config.yaml` contains the CCDB URL and the rules to be followed to clean up the database. An example is provided along this README (`config.yaml`).\nA typical rule in the config file looks like:\n```\n  - object_path: qc/ITS/.*\n    delay: 240\n    policy: 1_per_hour\n```\nThere can be any number of these rules. The order is important as we use the first matching rule for each element in the QCDB. \n- `object_path`: a pattern to be matched to know if the rule applies\n- `delay`: the duration in minutes of the grace period during which an object is not removed, even if it matches the above path. \n- `policy`: the name of a policy to apply on the matching objects. Here are the currently available policies (full description in the corresponding files):\n   - `1_per_hour`: keep the first and extend its validity to 1 hour, remove everything in the next hour, repeat.\n   - `1_per_run`: requires the \"Run\" or \"RunNumber\" metadata to be set. Keep only the most recent version of an object for a given run. \n   - `last_only`: keep only the last version, remove everything else.\n   - `none_kept`: keep none, remove everything\n   - `skip`: keep everything\n- `from_timestamp`: the rule only applies to versions whose `valid_from` is older than this timestamp\n- `to_timestamp`: the rule only applies to versions whose `valid_from` is younger than this timestamp\n- `xyz`: any extra argument necessary for a given policy. This is the case of the argument `delete_when_no_run` required by the policy `1_per_run`. \n\nThe configuration for ccdb-test is described [here](../../../doc/DevelopersTips.md). \n\n## Unit Tests\n`cd QualityControl/Framework/script/RepoCleaner ; python3 -m unittest discover`\n\nIn particular there is a test for the `production` rule that is pretty extensive. It hits the ccdb though and it needs the following path to be truncated: \n`\nqc/TST/MO/repo/test*\n`\n\n## Other tests\nMost of the classes and Rules have a main to help test them. To run do e.g. `python3 1_per_run.py`.\n\n## Installation\nCMake will install the python scripts in bin and the config file in etc.\n\n## Example\n\n```\nPYTHONPATH=./rules:$PYTHONPATH ./o2-qc-repo-cleaner --dry-run --config config-test.yaml --dry-run --only-path qc/DAQ --log-level 10\n```\n\n## Development\n\nTo install locally\n```\ncd Framework/script/RepoCleaner\npython3 -m pip install . \n```\n\n",
            "description_content_type": "text/markdown",
            "docs_url": null,
            "download_url": "",
            "downloads": {
                "last_day": -1,
                "last_month": -1,
                "last_week": -1
            },
            "home_page": "https://gitlab.cern.ch/AliceO2Group/QualityControl/Framework/script/RepoCleaner",
            "keywords": "",
            "license": "GPLv3",
            "maintainer": "",
            "maintainer_email": "",
            "name": "qcrepocleaner",
            "package_url": "https://pypi.org/project/qcrepocleaner/",
            "platform": null,
            "project_url": "https://pypi.org/project/qcrepocleaner/",
            "project_urls": {
                "Homepage": "https://gitlab.cern.ch/AliceO2Group/QualityControl/Framework/script/RepoCleaner"
            },
            "release_url": "https://pypi.org/project/qcrepocleaner/1.0/",
            "requires_dist": [
                "requests",
                "dryable",
                "responses",
                "PyYAML",
                "python-consul",
                "psutil"
            ],
            "requires_python": ">=3.6",
            "summary": "Set of tools to clean up the QCDB repository.",
            "version": "1.0",
            "yanked": false,
            "yanked_reason": null
        },
        "last_serial": 15954474,
        "urls": [
            {
                "comment_text": "",
                "digests": {
                    "md5": "c4e25a2a7a663ad9777ea0bc22b5a9b6",
                    "sha256": "5f6c126d36d93acf9a6992c87a93a3b18899ed9c41a6e939363c0ea282e503e2"
                },
                "downloads": -1,
                "filename": "qcrepocleaner-1.0-py3-none-any.whl",
                "has_sig": false,
                "md5_digest": "c4e25a2a7a663ad9777ea0bc22b5a9b6",
                "packagetype": "bdist_wheel",
                "python_version": "py3",
                "requires_python": ">=3.6",
                "size": 46884,
                "upload_time": "2022-12-01T12:12:45",
                "upload_time_iso_8601": "2022-12-01T12:12:45.426612Z",
                "url": "https://files.pythonhosted.org/packages/f4/bb/04629b3d2fd08608bc4fd15819780961a6d984c60a8325922cd614d992ba/qcrepocleaner-1.0-py3-none-any.whl",
                "yanked": false,
                "yanked_reason": null
            },
            {
                "comment_text": "",
                "digests": {
                    "md5": "6a24f104963203d6f913b79d03ddbccc",
                    "sha256": "9c6efd798caf9a9dc242b42a4e544510d7617d640523acef3e7cd4fc63d5a77e"
                },
                "downloads": -1,
                "filename": "qcrepocleaner-1.0.tar.gz",
                "has_sig": false,
                "md5_digest": "6a24f104963203d6f913b79d03ddbccc",
                "packagetype": "sdist",
                "python_version": "source",
                "requires_python": ">=3.6",
                "size": 22953,
                "upload_time": "2022-12-01T12:12:47",
                "upload_time_iso_8601": "2022-12-01T12:12:47.500325Z",
                "url": "https://files.pythonhosted.org/packages/35/64/ed610daeecdc747138f32e9924f31c2ea38cea19e6f4c8a42626639337da/qcrepocleaner-1.0.tar.gz",
                "yanked": false,
                "yanked_reason": null
            }
        ],
        "vulnerabilities": []
    }
}