{
    "0.1": {
        "info": {
            "author": "Vitalii Kleshchevnikov, Artem Shmatko, Emma Dann, Artem Lomakin, Alexander Aivazidis",
            "author_email": "vitalii.kleshchevnikov@sanger.ac.uk",
            "bugtrack_url": null,
            "classifiers": [],
            "description_content_type": "text/markdown",
            "docs_url": null,
            "download_url": "",
            "downloads": {
                "last_day": -1,
                "last_month": -1,
                "last_week": -1
            },
            "home_page": "https://github.com/BayraktarLab/cell2location",
            "keywords": "",
            "license": "Apache License, Version 2.0",
            "maintainer": "",
            "maintainer_email": "",
            "name": "cell2location",
            "package_url": "https://pypi.org/project/cell2location/",
            "platform": null,
            "project_url": "https://pypi.org/project/cell2location/",
            "project_urls": {
                "Homepage": "https://github.com/BayraktarLab/cell2location"
            },
            "release_url": "https://pypi.org/project/cell2location/0.1/",
            "requires_dist": null,
            "requires_python": "",
            "summary": "cell2location: High-throughput spatial mapping of cell types",
            "version": "0.1",
            "yanked": false,
            "yanked_reason": null
        },
        "last_serial": 13871881,
        "urls": [
            {
                "comment_text": "",
                "digests": {
                    "md5": "ecfcd4d1511d72b1486254c7b38deed3",
                    "sha256": "b455931025d4c71dbb3ae66834bd90167a5e1930d45c97e8d0847470e592565c"
                },
                "downloads": -1,
                "filename": "cell2location-0.1.tar.gz",
                "has_sig": false,
                "md5_digest": "ecfcd4d1511d72b1486254c7b38deed3",
                "packagetype": "sdist",
                "python_version": "source",
                "requires_python": null,
                "size": 80340,
                "upload_time": "2022-05-20T00:41:51",
                "upload_time_iso_8601": "2022-05-20T00:41:51.431887Z",
                "url": "https://files.pythonhosted.org/packages/fe/f1/aa6c82e53941167439d01529f05dc7ebc84485dbe1ce9859a6d54dbbdfeb/cell2location-0.1.tar.gz",
                "yanked": false,
                "yanked_reason": null
            }
        ],
        "vulnerabilities": []
    },
    "0.6a0": {
        "info": {
            "author": "Vitalii Kleshchevnikov, Artem Shmatko, Emma Dann, Artem Lomakin, Alexander Aivazidis",
            "author_email": "vitalii.kleshchevnikov@sanger.ac.uk",
            "bugtrack_url": null,
            "classifiers": [],
            "description": "<p align=\"center\">\n   <img src=\"https://github.com/BayraktarLab/cell2location/blob/master/docs/logo.svg\" width=\"200\">\n</p>\n\n### Comprehensive mapping of tissue cell architecture via integrated single cell and spatial transcriptomics (cell2location model)\n\n[![Docker Repository on Quay](https://quay.io/repository/vitkl/cell2location/status \"Docker Repository on Quay\")](https://quay.io/repository/vitkl/cell2location)\n[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/BayraktarLab/cell2location/blob/master/docs/notebooks/cell2location.ipynb)\n\nPreprint: https://www.biorxiv.org/content/10.1101/2020.11.15.378125v1 \n\nCell2location maps the spatial distribution of cell types by integrating single-cell RNA-seq (scRNA-seq) and multi-cell spatial transcriptomic data from a given tissue (Fig 1). Cell2location leverages reference cell type signatures that are estimated from scRNA-seq profiles, for example as obtained using conventional clustering to identify cell types and subpopulations followed by estimation of average cluster gene expression profiles. Cell2location implements this estimation step based on Negative Binomial regression, which allows to robustly combine data across technologies and batches. Using these reference signatures, cell2location decomposes mRNA counts in spatial transcriptomic data, thereby estimating the relative and absolute abundance of each cell type at each spatial location (Fig 1). \n\nCell2location is implemented as an interpretable hierarchical Bayesian model, (1) providing principled means to account for model uncertainty; (2) accounting for linear dependencies in cell type abundances, (3) modelling differences in measurement sensitivity across technologies, and (4) accounting for unexplained/residual variation by employing a flexible count-based error model. Finally, (5) cell2location is computationally efficient, owing to variational approximate inference and GPU acceleration. For full details and a comparison to existing approaches see our preprint (coming soon). The cell2location software comes with a suite of downstream analysis tools, including the identification of groups of cell types with similar spatial locations.\n\n\n![Fig1](docs/images/Fig1_v2_white_bg.png)   \nOverview of the spatial mapping approach and the workflow enabled by cell2location. From left to right: Single-cell RNA-seq and spatial transcriptomics profiles are generated from the same tissue (1). Cell2location takes scRNA-seq derived cell type reference signatures and spatial transcriptomics data as input (2, 3). The model then decomposes spatially resolved multi-cell RNA counts matrices into the reference signatures, thereby establishing a spatial mapping of cell types (4).    \n\n## Usage and Tutorials\n\nTutorials covering the estimation of expresson signatures of reference cell types (1/3), spatial mapping with cell2location (2/3) and the downstream analysis (3/3) can be found here: https://cell2location.readthedocs.io/en/latest/\n\nThere are 2 ways to install and use our package: setup your [own conda environment](https://github.com/BayraktarLab/cell2location#installation-of-dependecies-and-configuring-environment) or use the [singularity](https://github.com/BayraktarLab/cell2location#using-singularity-image) and [docker](https://github.com/BayraktarLab/cell2location#using-docker-image) images (recommended). See below for details.\n\nYou can also try cell2location on [Google Colab](https://colab.research.google.com/github/BayraktarLab/cell2location/blob/master/docs/notebooks/cell2location.ipynb) on a smaller data subset containing somatosensory cortex.\n\nPlease report buga via https://github.com/BayraktarLab/cell2location/issues and ask any usage questions in https://github.com/BayraktarLab/cell2location/discussions.\n\nWe also provide an experimental numpyro translation of the model which has improved memory efficiency (allowing analysis of multiple Visium samples on Google Colab) and minor improvements in speed - https://github.com/vitkl/cell2location_numpyro. You can try it on Google Colab [![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/vitkl/cell2location_numpyro/blob/main/docs/notebooks/cell2location_short_demo_colab.ipynb) - however note that both numpyro itself and cell2location_numpyro are in very active development. \n\nCell2location package is implemented in a general way to support multiple related models - both for spatial mapping and estimating signatures of cell types (tutorials use default models - no need to change):\n1. `LocationModelLinearDependentWMultiExperiment` - main model for estimating cell abundance by decomposing spatial data into reference expression signatures of cell types.\n2. `LocationModelWTA` - same as in #1 but adapted to work with Nanostring WTA data\n3. Similified versions of model #1 that lack particular features of the full model, accessible from `cell2location.models.simplified`\n\nModels for estimating reference expression signatures of cell types from scRNA data:\n1. `RegressionGeneBackgroundCoverageTorch` - estimating expression signatures of cell types, accounting for variable sequencing depth between batches (e.g. 10X reaction) and additive background (contaminating RNA).\n2. `RegressionGeneBackgroundCoverageGeneTechnologyTorch` - similar to #1 but additionally accounts for multiplicative platform effect between scRNA technologies.\n\nAdditionally we provide 2 models for downstream analysis of cell abundance estimates, accessible from `cell2location.models.downstream`:\n1. `CoLocatedGroupsSklearnNMF` - identifying groups of cell types with similar locations using NMF (wrapper around sklearn NMF). See tutorial #3 for usage.\n2. `ArchetypalAnalysis` - identifying smoothly varying and mutually exclusive tissue zones with Archetypa Analysis.\n\n## Installation\n\n1. Installing dependecies and configuring environment (Method 1 (preferred) and Method 2)\n2. Installing cell2location\n\nPrior to installing cell2location package you need to install miniconda and create a conda environment containing pymc3 and theano ready for use on GPU. Follow the steps below:\n\nIf you do not have conda please install Miniconda first:\n\n```bash\ncd /path/to/software\nwget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh\nbash Miniconda3-latest-Linux-x86_64.sh\n# use prefix /path/to/software/miniconda3\n```\n\nBefore installing cell2location and it's dependencies, make sure that you are creating a fully isolated conda environment by telling python to NOT use user site for installing packages, ideally by adding this line to your `~/.bashrc` file , but this would also work during a terminal session:\n```bash\nexport PYTHONNOUSERSITE=\"someletters\"\n```\n\n#### 1. Method 1 (preferred): Create environment from file\n\nCreate `cellpymc` environment from file, which will install all the required conda and pip packages:\n\n```bash\ngit clone https://github.com/BayraktarLab/cell2location.git\ncd cell2location\nconda env create -f environment.yml\n```\n\nUsing this method will likely resolve any issues that arise when trying to create the environment manually.\n\n#### 1. Method 2: Create conda environment manually\n\nCreate conda environment with the required packages pymc3 and scanpy:\n\n```bash\nconda create -n cellpymc python=3.7 numpy pandas jupyter leidenalg python-igraph scanpy \\\nlouvain hyperopt loompy cmake nose tornado dill ipython bbknn seaborn matplotlib request \\\nmkl-service pygpu --channel bioconda --channel conda-forge\n```\n\nDo not install pymc3 and theano with conda because it will not use the system cuda (GPU drivers) and we had problems with cuda installed in the local environment, install them with pip:\n\n```bash\nconda activate cellpymc\npip install plotnine \"arviz==0.10.0\" \"pymc3>=3.8,<3.10\" torch pyro-ppl\n```\n\n### 2. Install `cell2location` package\n\n```bash\nconda activate cellpymc\npip install git+https://github.com/BayraktarLab/cell2location.git\n```\n\nFinally, to use this environment in jupyter notebook, add jupyter kernel for this environment:\n\n```bash\nconda activate cellpymc\npython -m ipykernel install --user --name=cellpymc --display-name='Environment (cellpymc)'\n```\n\n## Using docker image\n\n[![Docker Repository on Quay](https://quay.io/repository/vitkl/cell2location/status \"Docker Repository on Quay\")](https://quay.io/repository/vitkl/cell2location)\n\n1. Make sure you have Docker Engine [installed](https://docs.docker.com/engine/install/). Note that you'll need root access for the installation.\n   1. (recommended) If you plan to utilize GPU install [Nvidia Container Toolkit](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker)\n2. Pull docker image\n\n       docker pull quay.io/vitkl/cell2location\n\n3. Run docker container with GPU support\n\n       docker run -i --rm -p 8848:8888 --gpus all quay.io/vitkl/cell2location:latest\n\n   Docker is an isolated execution environment, so by default it doesn't have access to your local files. You need to mount your local directory to your docker container:\n\n       docker run -v /host/directory:/container/directory -i --rm -p 8848:8888 --gpus all quay.io/vitkl/cell2location:latest\n\n   1. For running without GPU support use\n\n          docker run -i --rm -p 8848:8888 quay.io/vitkl/cell2location:latest\n\n4. Go to http://127.0.0.1:8848/?token= and log in using `cell2loc` token\n\n\n## Using singularity image\n\nSingularity environments are used in the compute cluster environments (check with your local IT if Singularity is provided on your cluster). Follow the steps here to use it on your system, assuming that you need to use the GPU:\n\n1. Download the container from our data portal:\n\n```\nwget https://cell2location.cog.sanger.ac.uk/singularity/cell2location-v0.06-alpha.sif\n```\n\n2. Submit a cluster job (LSF system) with GPU requested and start jupyter a notebook within a container (`--nv` option needed to use GPU):\n\n```\nbsub -q gpu_queue_name -M60000 \\\n  -R\"select[mem>60000] rusage[mem=60000, ngpus_physical=1.00] span[hosts=1]\"  \\\n  -gpu \"mode=shared:j_exclusive=yes\" -Is \\\n  /bin/singularity exec \\\n  --no-home  \\\n  --nv \\\n  -B /nfs/working_directory:/working_directory \\\n  path/to/cell2location-v0.06-alpha.sif \\\n  /bin/bash -c \"cd /working_directory && HOME=$(mktemp -d) jupyter notebook --notebook-dir=/working_directory --NotebookApp.token='cell2loc' --ip=0.0.0.0 --port=1237 --no-browser --allow-root\"\n```\nReplace **1)** the path to `/bin/singularity` with the one availlable on your system; **2)** the path to `/nfs/working_directory` to the directory which you need to work with (mount to the environment, `/nfs/working_directory:/working_directory`); **3)** path to the singularity image downloaded in step 1 (`path/to/cell2location-v0.06-alpha.sif`).\n\n3. Take a note of the cluster node name `node-name` that the job started on. Go to http://node-name:1237/?token= and log in using `cell2loc` token\n\n## Documentation and API details\n\nUser documentation is availlable on https://cell2location.readthedocs.io/en/latest/. \n\nThe architecture of the package is briefly described [here](https://github.com/BayraktarLab/cell2location/blob/master/cell2location/models/README.md). Cell2location architecture is designed to simplify extended versions of the model that account for additional technical and biologial information. We plan to provide a tutorial showing how to add new model classes but please get in touch if you would like to contribute or build on top our package.\n\nWe also provide an experimental numpyro translation of the model. Note that the pyro translation of cell2location in this repo does not work.\n\n## Acknowledgements \n\nWe thank all paper authors for their contributions:\nVitalii Kleshchevnikov, Artem Shmatko, Emma Dann, Alexander Aivazidis, Hamish W King, Tong Li, Artem Lomakin, Veronika Kedlian, Mika Sarkin Jain, Jun Sung Park, Lauma Ramona, Liz Tuck, Anna Arutyunyan, Roser Vento-Tormo, Moritz Gerstung, Louisa James, Oliver Stegle, Omer Ali Bayraktar\n\nWe also thank Krzysztof Polanski, Luz Garcia Alonso, Carlos Talavera-Lopez, Ni Huang for feedback on the package, Martin Prete for dockerising cell2location and other software support.\n\n## Common errors\n\n#### 1. Training cell2location on GPU takes forever (>50 hours)\n\n1. Training cell2location using `cell2location.run_cell2location()` on GPU takes forever (>50 hours). Please check that cell2location is actually using the GPU. It is crucial to add this line in your script / notebook:\n\n```python\n# this line should go before importing cell2location\nos.environ[\"THEANO_FLAGS\"] = 'device=cuda,floatX=float32,force_device=True'\nimport cell2location\n```\nwhich tells theano (cell2location dependency) to use the GPU before importing cell2location (or it's dependencies - theano & pymc3).\nFor data with 4039 locations and 10241 genes the analysis should take about 17-40 minutes depending on GPU hardware.\n\n#### 2. `FloatingPointError: NaN occurred in optimization.`\n\n2. `FloatingPointError: NaN occurred in optimization.` During training model parameters get into very unlikely range, resulting in division by 0 when computing gradients and breaking the optimisation:\n```\nFloatingPointError: NaN occurred in optimization. \nThe current approximation of RV `gene_level_beta_hyp_log__`.ravel()[0] is NaN.\n...\n```\nThis usually happens when:\n\n**A.** Numerical accuracy issues with older CUDA versions. **Solution**: use our singularity and docker images with CUDA 10.2.\n\n**B.** The single cell reference is a very poor match to the data - reference expression signatures of cell types cannot explain most of in-situ expression. E.g. trying to map immune cell types to a tissue section that contains mostly stromal and epithelial cells. **Solution**: aim to construct a comprehensive reference.\n\n**C.** Using cell2location in single-sample mode makes it harder to distinguish technology difference from cell abundance. **Solution**: if you have multiple expreriments try analysing them jointly in the multi-sample mode (detected automatically based on `'sample_name_col': 'sample'`).\n\n**D.** Many genes are not expressed in the spatial data. **Solution**: try removing genes detected at low levels in spatial data.\n\n#### 3. Theano fails to use the GPU at all (or cuDNN in particular)\n3. `Can not use cuDNN on context None: cannot compile with cuDNN. ...` and other related errors. If you see these error when importing cell2location it means that you have incorrectly installed theano and it's dependencies (fix depends on the platform). Without cuDNN support training takes >3 times longer. There are **2 solutions** to this:\n\n1. Use dockers/singularity images that are fully set up to work with the GPU (recommended).\n2. Add path to system CUDA installation to the following environmental variables by adding these lines to your `.bashrc` (modify accordingly for your system):\n\n```bash\n# cuda v\ncuda_v=-10.2\nexport CUDA_HOME=/usr/local/cuda$cuda_v\nexport CUDA_PATH=$CUDA_HOME\nexport LD_LIBRARY_PATH=/usr/local/cuda$cuda_v/lib64:$LD_LIBRARY_PATH\nexport PATH=/usr/local/cuda$cuda_v/bin:$PATH\n```\n\n## FAQ\n\nSee https://github.com/BayraktarLab/cell2location/discussions\n\n\n",
            "description_content_type": "text/markdown",
            "docs_url": null,
            "download_url": "",
            "downloads": {
                "last_day": -1,
                "last_month": -1,
                "last_week": -1
            },
            "home_page": "https://github.com/BayraktarLab/cell2location",
            "keywords": "",
            "license": "Apache License, Version 2.0",
            "maintainer": "",
            "maintainer_email": "",
            "name": "cell2location",
            "package_url": "https://pypi.org/project/cell2location/",
            "platform": "",
            "project_url": "https://pypi.org/project/cell2location/",
            "project_urls": {
                "Homepage": "https://github.com/BayraktarLab/cell2location"
            },
            "release_url": "https://pypi.org/project/cell2location/0.6a0/",
            "requires_dist": [
                "pyro-ppl (>=1.7.0)",
                "scvi-tools (>=0.12.2)",
                "torch (>=1.9.0)",
                "pymc3 (>=3.8<3.10)",
                "arviz (==0.10.0)",
                "numpy",
                "pandas",
                "scanpy",
                "plotnine",
                "black (>=21.4b0) ; extra == 'dev'",
                "flake8 ; extra == 'dev'",
                "pytest (>=5.0) ; extra == 'dev'",
                "pytest-cov ; extra == 'dev'",
                "isort ; extra == 'dev'",
                "pre-commit ; extra == 'dev'",
                "sphinx (==3.2.1) ; extra == 'docs'",
                "nbsphinx (==0.8.7) ; extra == 'docs'",
                "sphinx-rtd-theme (==0.5.2) ; extra == 'docs'",
                "leidenalg (>=0.8.0) ; extra == 'tutorials'",
                "python-igraph ; extra == 'tutorials'"
            ],
            "requires_python": "",
            "summary": "cell2location: High-throughput spatial mapping of cell types",
            "version": "0.6a0",
            "yanked": false,
            "yanked_reason": null
        },
        "last_serial": 13871881,
        "urls": [
            {
                "comment_text": "",
                "digests": {
                    "md5": "b46f41c4320ecc2913f85d1fe27022e1",
                    "sha256": "d2f4103119ef319ceaedd6ecbe9ebe1c37bdd240b5b77fd89db603dfde879b97"
                },
                "downloads": -1,
                "filename": "cell2location-0.6a0-py3-none-any.whl",
                "has_sig": false,
                "md5_digest": "b46f41c4320ecc2913f85d1fe27022e1",
                "packagetype": "bdist_wheel",
                "python_version": "py3",
                "requires_python": null,
                "size": 179041,
                "upload_time": "2021-09-02T15:12:16",
                "upload_time_iso_8601": "2021-09-02T15:12:16.454148Z",
                "url": "https://files.pythonhosted.org/packages/a7/88/dd926187e197aeff7e20fe98c980e33cd2d5d029de1b3e86119826a48695/cell2location-0.6a0-py3-none-any.whl",
                "yanked": false,
                "yanked_reason": null
            }
        ],
        "vulnerabilities": []
    }
}