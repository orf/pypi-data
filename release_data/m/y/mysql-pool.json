{
    "0.1": {
        "info": {
            "author": "bfzs",
            "author_email": "ydf0509@sohu.com",
            "bugtrack_url": null,
            "classifiers": [
                "Development Status :: 4 - Beta",
                "Intended Audience :: Developers",
                "License :: OSI Approved :: BSD License",
                "Operating System :: OS Independent",
                "Programming Language :: Python",
                "Programming Language :: Python :: 3.6",
                "Programming Language :: Python :: Implementation",
                "Topic :: Software Development :: Libraries"
            ],
            "description_content_type": "text/markdown",
            "docs_url": null,
            "download_url": "",
            "downloads": {
                "last_day": -1,
                "last_month": -1,
                "last_week": -1
            },
            "home_page": "",
            "keywords": "mysql pool",
            "license": "BSD License",
            "maintainer": "ydf",
            "maintainer_email": "ydf0509@sohu.com",
            "name": "mysql-pool",
            "package_url": "https://pypi.org/project/mysql-pool/",
            "platform": "all",
            "project_url": "https://pypi.org/project/mysql-pool/",
            "project_urls": null,
            "release_url": "https://pypi.org/project/mysql-pool/0.1/",
            "requires_dist": null,
            "requires_python": "",
            "summary": "mysql_pool",
            "version": "0.1",
            "yanked": false,
            "yanked_reason": null
        },
        "last_serial": 11843825,
        "urls": [
            {
                "comment_text": "",
                "digests": {
                    "md5": "ce2d94a70e74ae2b63255b5efcc9ba99",
                    "sha256": "ae1f233ccdcd3185e554165e397efade0cfc2e4a4e0c81ad4c09188a5df207e3"
                },
                "downloads": -1,
                "filename": "mysql_pool-0.1.tar.gz",
                "has_sig": false,
                "md5_digest": "ce2d94a70e74ae2b63255b5efcc9ba99",
                "packagetype": "sdist",
                "python_version": "source",
                "requires_python": null,
                "size": 3178,
                "upload_time": "2021-10-27T07:15:23",
                "upload_time_iso_8601": "2021-10-27T07:15:23.608898Z",
                "url": "https://files.pythonhosted.org/packages/b1/c8/b85f98dbc27d64efeca6850a0dc806fe12c26efcc10bdbb7c68797d59e6b/mysql_pool-0.1.tar.gz",
                "yanked": false,
                "yanked_reason": null
            }
        ],
        "vulnerabilities": []
    },
    "0.2": {
        "info": {
            "author": "bfzs",
            "author_email": "ydf0509@sohu.com",
            "bugtrack_url": null,
            "classifiers": [
                "Development Status :: 4 - Beta",
                "Intended Audience :: Developers",
                "License :: OSI Approved :: BSD License",
                "Operating System :: OS Independent",
                "Programming Language :: Python",
                "Programming Language :: Python :: 3.6",
                "Programming Language :: Python :: Implementation",
                "Topic :: Software Development :: Libraries"
            ],
            "description": "# mysql_pool \u662f \u4f7f\u7528python\u901a\u7528\u5bf9\u8c61\u6c60 universal_object_pool \u9a71\u52a8\u7684mysql\u8fde\u63a5\u6c60\n\n```\n\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u64cd\u4f5cmysql\uff0c\u4e0d\u80fd\u591a\u7ebf\u7a0b\u64cd\u4f5c\u540c\u4e00\u4e2aconnection\uff0c\u5426\u5219\u4f1a\u9020\u6210\u4e8b\u52a1\u6df7\u4e71\u75af\u72c2\u62a5\u9519\n\n\u8981\u4e48\u7ebf\u7a0b\u5185\u90e8\u7684\u51fd\u6570\u91cc\u9762\u6bcf\u6b21\u4e34\u65f6\u521b\u5efamysql\u8fde\u63a5\uff0c\u7136\u540e\u6467\u6bc1\u8fde\u63a5\u3002\u53cd\u590d\u9891\u7e41\u521b\u5efa\u8fde\u63a5\u4ee3\u4ef7\u5927\n\n\u8981\u4e48\u5c31\u662f\u7528mysql\u8fde\u63a5\u6c60\uff0c\nmysql_pool\u662f\u4f7f\u7528\u4e07\u80fd\u901a\u7528\u5bf9\u8c61\u6c60\u5b9e\u73b0\u7684mysql\u8fde\u63a5\u6c60\uff0c\u5b8c\u5168\u4e0d\u4f9d\u8d56Dbutils\u5e93\u6765\u5b9e\u73b0\u8fde\u63a5\u6c60\u3002\n```\n\n## 0. \u5b89\u88c5 pip install mysql_pool\n\n## 1 \u4f7f\u7528\u4f8b\u5b50\u548c\u6d4b\u8bd5\u4ee3\u7801\n\n```python\nimport typing\nimport time\nimport pymysql\nfrom threadpool_executor_shrink_able import BoundedThreadPoolExecutor\nimport decorator_libs\nfrom mysql_pool import ObjectPool,PyMysqlOperator\n\n\"\"\"\n\u6d4b\u8bd5mysql\u8fde\u63a5\u6c60\uff0c\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u5fc5\u987b\u4f7f\u7528\u8fde\u63a5\u6c60\n\"\"\"\n\nmysql_pool = ObjectPool(object_type=PyMysqlOperator, object_pool_size=100, object_init_kwargs={'port': 3306})\n\n\ndef test_update(i):\n    sql = f'''\n        INSERT INTO db1.table1(uname ,age)\n    VALUES(\n        %s ,\n        %s)\n    ON DUPLICATE KEY UPDATE\n        uname = values(uname),\n        age = if(values(age)>age,values(age),age);\n    '''\n    with mysql_pool.get(timeout=2) as operator:  # type: typing.Union[PyMysqlOperator,pymysql.cursors.DictCursor] #\u5229\u4e8e\u8865\u5168\n        # operator \u62e5\u6709 cursor\u5bf9\u8c61\u7684\u6240\u6709\u7528\u6cd5\u3002\n        print(id(operator.cursor), id(operator.conn))\n        operator.execute(sql, args=(f'name_{i}', i * 4))\n        print(operator.lastrowid)  # opererator \u81ea\u52a8\u62e5\u6709 operator.cursor \u7684\u6240\u6709\u65b9\u6cd5\u548c\u5c5e\u6027\u3002 opererator.methodxxx \u4f1a\u81ea\u52a8\u8c03\u7528 opererator.cursor.methodxxx\n\n\nconn = pymysql.connect(host='192.168.6.130')\n\n\ndef test_update_multi_threads_use_one_conn(i):\n    \"\"\"\n    \u8fd9\u662f\u4e2a\u5927\u9519\u7279\u9519\u7684\u4f8b\u5b50\uff0c\u591a\u7ebf\u7a0b\u64cd\u4f5c\u540c\u4e00\u4e2a\u8fde\u63a5\uff0c\u9020\u6210\u4e8b\u52a1\u6df7\u4e71\u3002\n    \u8fd9\u4e2a\u662f\u4e2a\u9519\u8bef\u7684\u4f8b\u5b50\uff0c\u591a\u7ebf\u7a0b\u8fd0\u884c\u6b64\u51fd\u6570\u4f1a\u75af\u72c2\u62a5\u9519,\u5355\u7ebf\u7a0b\u4e0d\u62a5\u9519\u3002\n    \u8fd9\u4e2a\u5982\u679c\u8fd0\u884c\u5728\u591a\u7ebf\u7a0b\u540c\u65f6\u64cd\u4f5c\u540c\u4e00\u4e2aconn\uff0c\u5c31\u4f1a\u75af\u72c2\u62a5\u9519\u3002\u6240\u4ee5\u8981\u4e48\u72e0low\u7684\u4f7f\u7528\u4e34\u65f6\u9891\u7e41\u5728\u51fd\u6570\u5185\u90e8\u6bcf\u6b21\u521b\u5efa\u548c\u6467\u6bc1mysql\u8fde\u63a5\uff0c\u8981\u4e48\u4f7f\u7528\u8fde\u63a5\u6c60\u3002\n    :param i:\n    :return:\n    \"\"\"\n    sql = f'''\n        INSERT INTO db1.table1(uname ,age)\n    VALUES(\n        %s ,\n        %s)\n    ON DUPLICATE KEY UPDATE\n        uname = values(uname),\n        age = if(values(age)>age,values(age),age);\n    '''\n\n    cur = conn.cursor()\n    cur.execute(sql, args=(f'name_{i}', i * 3))\n    cur.close()\n    conn.commit()\n\n\nthread_pool = BoundedThreadPoolExecutor(20)\nwith decorator_libs.TimerContextManager():\n    for x in range(200000, 300000):\n        thread_pool.submit(test_update, x)\n        # thread_pool.submit(test_update_multi_threads_use_one_conn, x)\n    thread_pool.shutdown()\ntime.sleep(10000)  #\u8fd9\u4e2a\u53ef\u4ee5\u6d4b\u8bd5\u9a8c\u8bc1\uff0c\u6b64\u5bf9\u8c61\u6c60\u4f1a\u81ea\u52a8\u6467\u6bc1\u8fde\u63a5\u5982\u679c\u95f2\u7f6e\u65f6\u95f4\u592a\u957f\uff0c\u4f1a\u81ea\u52a8\u6467\u6bc1\u5bf9\u8c61\n```",
            "description_content_type": "text/markdown",
            "docs_url": null,
            "download_url": "",
            "downloads": {
                "last_day": -1,
                "last_month": -1,
                "last_week": -1
            },
            "home_page": "",
            "keywords": "mysql pool",
            "license": "BSD License",
            "maintainer": "ydf",
            "maintainer_email": "ydf0509@sohu.com",
            "name": "mysql-pool",
            "package_url": "https://pypi.org/project/mysql-pool/",
            "platform": "all",
            "project_url": "https://pypi.org/project/mysql-pool/",
            "project_urls": null,
            "release_url": "https://pypi.org/project/mysql-pool/0.2/",
            "requires_dist": null,
            "requires_python": "",
            "summary": "mysql_pool",
            "version": "0.2",
            "yanked": false,
            "yanked_reason": null
        },
        "last_serial": 11843825,
        "urls": [
            {
                "comment_text": "",
                "digests": {
                    "md5": "a22be8ba811ce1f149f5dbb57f5236f0",
                    "sha256": "ee1cd24f715a6230804025daef9ba9febddeed903a827369659c129008e1f6bb"
                },
                "downloads": -1,
                "filename": "mysql_pool-0.2.tar.gz",
                "has_sig": false,
                "md5_digest": "a22be8ba811ce1f149f5dbb57f5236f0",
                "packagetype": "sdist",
                "python_version": "source",
                "requires_python": null,
                "size": 3199,
                "upload_time": "2021-10-27T07:21:19",
                "upload_time_iso_8601": "2021-10-27T07:21:19.471694Z",
                "url": "https://files.pythonhosted.org/packages/e6/b9/19747bdbc4f235f76a3409824236e87e68f77362d1d31df0b7d51d0808d7/mysql_pool-0.2.tar.gz",
                "yanked": false,
                "yanked_reason": null
            }
        ],
        "vulnerabilities": []
    }
}