{
    "0.2": {
        "info": {
            "author": "Tri Dao",
            "author_email": "trid@stanford.edu",
            "bugtrack_url": null,
            "classifiers": [
                "License :: OSI Approved :: BSD License",
                "Operating System :: Unix",
                "Programming Language :: Python :: 3"
            ],
            "description": "# FlashAttention\nThis repository provides the official implementation of FlashAttention from the\nfollowing paper.\n\n**FlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness**  \nTri Dao, Daniel Y. Fu, Stefano Ermon, Atri Rudra, Christopher R\u00e9  \nPaper: https://arxiv.org/abs/2205.14135  \nIEEE Spectrum [article](https://spectrum.ieee.org/mlperf-rankings-2022) about our submission to the MLPerf 2.0 benchmark using FlashAttention.\n![FlashAttention](assets/flashattn_banner.jpg)\n\n## Usage\n\nWe've been very happy to see FlashAttention being widely adopted in such a short\ntime after its release. This [page](https://github.com/HazyResearch/flash-attention/blob/main/usage.md)\ncontains a partial list of places where FlashAttention is being used.\n\n## Triton implementation of FlashAttention\n\nPhil Tillet (OpenAI) has an experimental implementation of FlashAttention in Triton:\nhttps://github.com/openai/triton/blob/master/python/tutorials/06-fused-attention.py  \n\nAs Triton is a higher-level language than CUDA, it might be easier to understand\nand experiment with. The notations in the Triton implementation are also closer\nto what's used in our paper.\n\n\n## Beta release (0.2).\n\nTo install (requiring CUDA 11, NVCC, and an Turing or Ampere GPU):\n```sh\npip install flash-attn\n```\n\nAlternatively you can compile from source:\n```\npython setup.py install\n```\n\nInterface: `src/flash_attention.py`\n\nTo run the benchmark against PyTorch standard attention: \n```\nPYTHONPATH=$PWD python benchmarks/benchmark_flash_attention.py\n```\n\nFlashAttention currently supports:\n1. Turing or Ampere GPUs (e.g., A100, RTX 3090, T4, RTX 2080).\n2. fp16 and bf16 (bf16 requires Ampere GPUs).\n3. Head dimensions that are multiples of 8, up to 128 (e.g., 8, 16, 24, ..., 128). Head dim > 64 backward requires A100.\n\nOur tentative roadmap:\n1. ~~[Jun 2022] Make package pip-installable~~[Done, thanks to lucidrains].\n2. ~~[Jun 2022] Support SM86 GPUs (e.g., RTX 3080, 3090)~~[Done].\n3. [Jun 2022] Refactor to use Cutlass.\n4. ~~[Jun 2022] Support SM75 GPUs (e.g. T4)~~[Done].\n5. ~~[Jun 2022] Support bf16~~[Done].\n6. ~~[Jul 2022] Implement cross-attention~~[Done].\n7. ~~[Jul 2022] Support head dimension 128~~[Done].\n8. [Jul 2022] Support SM70 GPUs (V100).\n9. ~~[Aug 2022] Fuse rotary embedding~~[Done].\n10. [Aug 2022] Support attention bias (e.g. ALiBi, relative positional encoding).\n\n## Speedup and Memory Savings\n\nWe present expected speedup (combined forward + backward pass) and memory savings from using FlashAttention against PyTorch standard attention, depending on sequence length, on different GPUs (speedup depends on memory bandwidth - we see more speedup on slower GPU memory).\n\nWe currently have benchmarks for these GPUs:\n* [A100](#a100)\n* [RTX 3090](#rtx-3090)\n* [T4](#t4)\n\n### A100\n\nWe display FlashAttention speedup using these parameters (similar to BERT-base):\n* Batch size 8\n* Head dimension 64\n* 12 attention heads\n\nOur graphs show sequence lengths between 128 and 4096 (when standard attention runs out of memory on an A100), but FlashAttention can scale up to sequence length 64K.\n\n#### Speedup\n\n![FlashAttention speedup](assets/flashattn_speedup.jpg)\n\nWe generally see 2-4X speedup at sequence lengths between 128 and 4K, and we see more speedup when using dropout and masking, since we fuse the kernels.\nAt sequence lengths that are popular with language models like 512 and 1K, we see speedups up to 4X when using dropout and masking.\n\n#### Memory\n\n![FlashAttention memory](assets/flashattn_memory.jpg)\n\nWe show memory savings in this graph (note that memory footprint is the same no matter if you use dropout or masking).\nMemory savings are proportional to sequence length -- since standard attention has memory quadratic in sequence length, whereas FlashAttention has memory linear in sequence length.\nWe see 10X memory savings at sequence length 2K, and 20X at 4K.\nAs a result, FlashAttention can scale to much longer sequence lengths.\n\n#### Head Dimension 128\n\n![FlashAttention speedup, head dimension 128](assets/flashattn_speedup_a100_d128.jpg)\n\nWe show speedup with head dimension 128.\nHere we show batch size 16 with 12 heads.\nSpeedup is less than with the smaller head sizes, since we have to make the block size smaller in the tiling.\nBut speedup is still significant, especially with a causal mask.\n\n### RTX 3090\n\nFor the RTX 3090, we use batch size 12 with 12 attention heads.\nMemory savings are the same as on an A100, so we'll only show speedup here.\n\n![FlashAttention speedup GTX 3090](assets/flashattn_speedup_3090.jpg)\n\nWe see slightly higher speedups (between 2.5-4.5x) on the GTX 3090, since memory bandwidth on the GDDR6X is lower than A100 HBM (~900 GB/s vs. ~1.5 TB/s).\n\n### T4\n\nWe again use batch size 12 with 12 attention heads.\n\n![Flashattention speedup T4](assets/flashattn_speedup_t4.jpg)\n\nT4 SRAM is smaller than the newer GPUs (64 KB), so we see less speedup (we need to make the block sizes smaller, so we end up doing more R/W).\nThis matches the IO complexity analysis from section 3.2 of [our paper](https://arxiv.org/abs/2205.14135).\n\nT4 GPUs are commonly used for inference, so we also measure speedup on the forward pass only (note that these are not directly comparable to the graphs above):\n\n![FlashAttention speedup T4 fwd](assets/flashattn_speedup_t4_fwd.jpg)\n\nWe see speedups between 2.5x-4.5x on the forward pass.\n\n## Tests\nWe test that FlashAttention produces the same output and gradient as a reference\nimplementation, up to some numerical tolerance. In particular, we check that the\nmaximum numerical error of FlashAttention is at most twice the numerical error\nof a baseline implementation in Pytorch (for different head dimensions, input\ndtype, sequence length, causal / non-causal).\n\nTo run the tests:\n```\npytest -q -s tests/test_flash_attn.py\n```\n## When you encounter issues\n\nThis alpha release of FlashAttention contains code written for a research\nproject to validate ideas on speeding up attention. \nWe have tested it on several models (BERT, GPT2, ViT). \nHowever, there might still be bugs in the implementation that we hope to iron\nout in the next few months.\n\nIf you encounter any of these bugs, please open a respective GitHub Issue!\n\n## Acknowledgments\nOur implementation uses Apex's\n[FMHA](https://github.com/NVIDIA/apex/tree/master/apex/contrib/csrc/fmha) code\nas a starting point.\n\nWe thank [Young-Jun Ko](https://yjk21.github.io/) for the in-depth explanation of his FMHA implementation\nand for his thoughtful answers to our questions about CUDA.\n\n## Citation\nIf you use this codebase, or otherwise found our work valuable, please cite:\n```\n@inproceedings{dao2022flashattention,\n  title={FlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness},\n  author={Dao, Tri and Fu, Daniel Y. and Ermon, Stefano and Rudra, Atri and R{\\'e}, Christopher},\n  booktitle={Advances in Neural Information Processing Systems},\n  year={2022}\n}\n```\n\n\n",
            "description_content_type": "text/markdown",
            "docs_url": null,
            "download_url": "",
            "downloads": {
                "last_day": -1,
                "last_month": -1,
                "last_week": -1
            },
            "home_page": "https://github.com/HazyResearch/flash-attention",
            "keywords": "",
            "license": "",
            "maintainer": "",
            "maintainer_email": "",
            "name": "flash-attn",
            "package_url": "https://pypi.org/project/flash-attn/",
            "platform": null,
            "project_url": "https://pypi.org/project/flash-attn/",
            "project_urls": {
                "Homepage": "https://github.com/HazyResearch/flash-attention"
            },
            "release_url": "https://pypi.org/project/flash-attn/0.2/",
            "requires_dist": null,
            "requires_python": ">=3.7",
            "summary": "Flash Attention: Fast and Memory-Efficient Exact Attention",
            "version": "0.2",
            "yanked": false,
            "yanked_reason": null
        },
        "last_serial": 15781278,
        "urls": [
            {
                "comment_text": "",
                "digests": {
                    "md5": "3bfb29043409d61024aacbb55613010b",
                    "sha256": "ba1f0cbcfa50b4bbc0f926fe35029b6f1ceb231c606327712d2980b2b683297a"
                },
                "downloads": -1,
                "filename": "flash_attn-0.2.tar.gz",
                "has_sig": false,
                "md5_digest": "3bfb29043409d61024aacbb55613010b",
                "packagetype": "sdist",
                "python_version": "source",
                "requires_python": ">=3.7",
                "size": 1487049,
                "upload_time": "2022-11-15T22:11:13",
                "upload_time_iso_8601": "2022-11-15T22:11:13.732993Z",
                "url": "https://files.pythonhosted.org/packages/3b/95/e90f22281171704eb8b0f5934f07e2142015f1b6008f3963a5ffe8c8b6a6/flash_attn-0.2.tar.gz",
                "yanked": false,
                "yanked_reason": null
            }
        ],
        "vulnerabilities": []
    }
}