{
    "2.0.0": {
        "info": {
            "author": "MartinWiechmann",
            "author_email": "martin.wiechmann.office@gmail.com",
            "bugtrack_url": null,
            "classifiers": [
                "Development Status :: 5 - Production/Stable",
                "Environment :: Console",
                "Intended Audience :: Developers",
                "License :: OSI Approved :: MIT License",
                "Operating System :: OS Independent",
                "Programming Language :: Python :: 3",
                "Topic :: Security"
            ],
            "description": "# AEnv former CredoPy!\n[![OS](https://img.shields.io/badge/Runs%20on%3A-Linux%20%7C%20Mac%20%7C%20Windows-green)]() [![RunsOn](https://img.shields.io/badge/Used%20technologies-AWS%20%7C%20Python%203-green)]() [![RunsOn](https://img.shields.io/github/license/MartinWie/AEnv)](https://github.com/MartinWie/AEnv/blob/master/LICENSE) [![Open Source](https://badges.frapsoft.com/os/v1/open-source.svg?v=103)](https://opensource.org/)\n\n![AEnv](https://github.com/MartinWie/AEnv/blob/master/AEnv_logo_no_bg.png)\n\n## Installation\n\n* Install python3 and pip\n\n* [Install AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html)\n\n* Install aenv:\n\n```\npip install aenv\n\n# For old pydo package:\npip install credopy\n```\n\n* For YubiKey support install the [YubiKey Manager CLI](https://github.com/Yubico/yubikey-manager#installation)\n\n* On Windows [setup Boto3 credentials](https://pypi.org/project/boto3/) \n\n\n## No passwords in code!\n\nMake your company more secure by using the \"troy password credo\"! \n\nEasier said than done working with credentials can get very messy and lead to huge security and data protection problems. So while working at [troy gmbh](https://www.linkedin.com/company/troy-gmbh/) it became clear that we had to define some fundamental rules to maintain a high level of security during fast growth phases. This brought up the \"troy password credo\".\n\n### troy password credo:\nYou may ask \"What is the famous troy password credo?\"\nIt's very simple: **Never** store credentials unencrypted!\n\n\n## Let's get started\n\nWorking with Credentials can be fun, but from a security perspective, most of the time it isn't! Especially if you have multiple systems and different environments.\n\nIf you're using the AWS cloud you found the right repository!\n\nAEnv is a tool that injects aws parameter store strings and secure strings into your memory as an environment variable. With this, your important credentials/security keys/... never have to touch your disk again.\n\nAnd because the parameter store supports paths you can define different services with different environments.\n\nFor example:\n\n```\n/<Environment>/<KotlinApp1>/\n\n#which could look like:\n/Prod/CustomerManagement/DB/USER\n\n#or\n/Prod/CustomerManagement/DB/PASSWORD\n```\n\nOutput these example data (The database password for CustomerManagement in production ):\n\n\n```\naenv -e Prod -s CustomerManagement echo '$SECRET_CUSTOMERMANAGEMENT_DB_PASSWORD'\n```\n\nWith both parameters, your \"CustomerManagement\" application/service (launched with aenv) could now access the database with the provided username and password.\n\nDetails at: [How to access the environment variables](https://github.com/MartinWie/AEnv#how-to-access-the-environment-variables)\n\n\n## Usage \n\n```\naenv [-s <service/application>] [-i] [-n] [-e <env>] [-t <2fa key>] [-T] [-Y] [-u <aws username>] [-a <account number>] [-p <aws profile>] [-r <region>] <command>\n```\n\n**Options:**\n\n| Option | explination | sample | comment \n| :- | :- | :- | :-\n|-h | Shows help | aenv -h |\n|-i | Starts aenv in interactive mode | aenv -i | Gives you a command line that you can interact with |\n|-s \\<service/application> | For which service should the environment variables be loaded? | aenv -s CustomerService\n|-S | Sets a default service for aenv and writes it to a config file | aenv -S CustomerService | from now on \"CustomerService\" is the default service which means \"-s CustomerService\" is redundant \n|-n | Do not query the parameter store at all  | aenv -n | Can be used to auth the current session with MFA\n|-e \\<env> | For which environment should the environment variables be loaded? For example Dev, Test or Prod (permission required) | aenv -e Prod | \n|-t \\<2fa key> | Takes the 2FA key from your aws account | aenv -t 987123\n|-T | Lets you type in the 2FA key from your aws account during runtime | aenv -T | When you run your command aenv will ask for the token |\n|-Y | Uses Yubikey for MFA auth | aenv -Y | During runtime aenv will use ykman to fetch the MFA-Key from your yubikey\n|-r \\<region> | Overwrites temporary the awscli default region | aenv -r eu-central-1 | aenv will use the given region for example Frankfurt\n|-q | Quiet mode (less output) | aenv -q |\n|-u \\<aws username> | Sets a specific username combined with -a gives you a faster runtime (otherwise this data needs to be retrieved via aws) | aenv -u user@example.de |\n|-a \\<account number> | Sets a specific account number combined with -u gives you a faster runtime (otherwise this data needs to be retrieved via aws) | aenv -a 999999999999 | \n|-p \\<aws profile> | If multiple aws profiles are available you can choose the profile otherwise aenv will use the default profile | aenv -p testUser1\n|-c \\<aws profile> | Container mode(enable this to make aenv work in ecs and codebuild) | aenv -c | [permissions](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_execution_IAM_role.html)\n|\\<command> | Is the command to execute with environment variables injected. | aenv code | Will run VS Code with access to given environment variables\n\nNote: **It may be required to double escaping.**\n\nExamples:\n\n**Linux:**\n\naenv echo '$SECRET_CUSTOMERSERVICE_UI_URL'\n\nor\n\n**Windows:**\n\naenv echo %SECRET_CUSTOMERSERVICE_UI_URL%  \n\n**Mac:**\n\naenv \"/Applications/IntelliJ\\ IDEA\\ CE.app/Contents/MacOS/idea\"\n\n**Note** the quoting of the variable.\n\n## Enforce MFA authentication for AWS feature / function\n\nAdd the condition \"MultiFactorAuthPresent\" to your IAM permission:\n\n```\n    \"Condition\": {\"Bool\": {\"aws:MultiFactorAuthPresent\": \"true\"}}\n```\n\nSample for sts:AssumeRole: \n\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": {\n    \"Effect\": \"Allow\",\n    \"Principal\": {\"AWS\": \"ACCOUNT-B-ID\"},\n    \"Action\": \"sts:AssumeRole\",\n    \"Condition\": {\"Bool\": {\"aws:MultiFactorAuthPresent\": \"true\"}}\n  }\n}\n```\n\nNow you need MFA authentication to run assume role commands.\nSample call for this would be:\n\n```\naenv -q -n -Y aws sts assume-role --role-arn \"arn:aws:iam::123456789012:role/example-role\" --role-session-name AWSCLI-Session\n\n# -q removes the unnecessary output\n# -n puts aenv in only authentication mode\n# -Y authenticates the session with your YubiKey, alternatively you could use -t or -T\n```\n\n### Enforce MFA authentication for all Prod parameters\n\nTo enforce MFA authentication for all Prod parameters.\n\n(Do not forget to adapt to account ID(123456789098) to your own ;) )  \n\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"VisualEditor0\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ssm:PutParameter\",\n                \"ssm:DeleteParameter\",\n                \"ssm:GetParameterHistory\",\n                \"ssm:GetParametersByPath\",\n                \"ssm:GetParameters\",\n                \"ssm:ListTagsForResource\",\n                \"ssm:GetParameter\",\n                \"ssm:DeleteParameters\"\n            ],\n            \"Resource\": [\n                \"arn:aws:ssm:*:123456789098:parameter/Prod/*\"\n            ],\n            \"Condition\": {\n                \"Bool\": {\n                    \"aws:MultiFactorAuthPresent\": \"true\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"VisualEditor1\",\n            \"Effect\": \"Allow\",\n            \"Action\": \"ssm:DescribeParameters\",\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n## Format for these environment variables:\n\nEvery environment variable that is loaded with aenv starts with \"SECRET_\".\n\nThen the service-name and path, separated by underliners.\n\n(of course in upper case)\n\nFor example: \n\n```\nSECRET_CUSTOMERMANAGEMENT_DB_USER\n```\n\nMore about environment variables: [Guide to Unix/Environment Variables](https://en.wikibooks.org/wiki/Guide_to_Unix/Environment_Variables)\n\nThis is maybe made more clear by the following example:\n\n```\n/Prod/CustomerManagement/DB/USER\n```\n\nwould be accessible with:\n\n```\nSECRET_CUSTOMERMANAGEMENT_DB_USER\n```\n\nor\n\n```\n/Prod/CustomerManagement/DB/PASSWORD\n```\n\nwould be accessible with:\n\n```\nSECRET_CUSTOMERMANAGEMENT_DB_PASSWORD\n```\n\n## Environments\n\nWe now talked a lot about environments, but how can aenv differ between different environments like dev, test, or prod?\n\nQuite simply, you tell it!\n\n**Parameterstore:**\n\nAs already mentioned you Define the environment as the first section.\n\nLet's take the previous example:\n\n```\n/Prod/CustomerManagement/DB/PASSWORD\n```\n\nhere \"Prod\" is our environment for the database(DB) password (PASSWORD) of our CustomerManagement service/application, but we could easily also set this for our test environment like this:\n\n```\n/Test/CustomerManagement/DB/PASSWORD\n```\n\n(When creating new parameters don't forget to create them as \"SecureString's\" ;) )\n\nBonus content: \n\nConverting parameter store strings to secure strings\nFound this in my old files, before using this **test and make sure it really works** but with this snippet, you should be able to convert every normal parameter store string to a secure string.\n\n**No guarantee for functionality, make sure you have a backup of the parameter store variables**\n\n```\nimport boto3\nclient = boto3.client('ssm')\nresponse = client.describe_parameters()\nnameList = []\ndic = {}\ndic_descr = {}\n\nfor p in response['Parameters']:\n    nameList.append(p['Name'])\n    dic_descr[p['Name']] = p.get('Description')\n\nnextToken_Str = response['NextToken']\n\nwhile nextToken_Str:\n    response = client.describe_parameters(NextToken=nextToken_Str)\n    \n    for p in response['Parameters']:\n        nameList.append(p['Name'])\n        dic_descr[p['Name']] = p.get('Description')\n    \n    nextToken_Str = response.get('NextToken', None)\n        \nfor name in nameList:\n    response = client.get_parameter(Name=name, WithDecryption=True)\n    dic[name] = response.get('Parameter').get('Value')\n\n\nfor name in dic:\n    if dic_descr[name] is not None:\n        print(client.put_parameter(\n            Name=name,\n            Description=dic_descr[name],\n            Value=dic[name],\n            Type='SecureString',\n            Overwrite=True\n        ))\n    else:\n        print(client.put_parameter(\n            Name=name,\n            Value=dic[name],\n            Type='SecureString',\n            Overwrite=True\n        ))\n\n```\n\n**Client/You**\n\nWith\n\n```\naenv -e <env>\n```\n\nyou can launch aenv for every in the parameterstore defined environment.\n\nIf you don't set any aenv swtiches to \"Dev\"\n\n**AWS Server**\n\nwhen aenv runs on an aws machine you could run it with \"-e \\<env>\" but this is rather inconvenient. So aenv queries the instance tags and searches for the key \"environment\" and uses its value as the current environment. If the environment tag is not set and you did not provide an environment with \"-e\" aenv automatically defaults to \"Dev\"\n\n\n## How to access the environment variables\n\nTo access those environment variables you have to run your application/service with aenv.\n\n```\naenv java -jar service.jar\n//or\naenv python service2.py\n```\n\nNow these two services have all environment variables for their service and environment available and can work with them here are two easy examples:\n\n**Python:**\n\n```\nimport os\nos.getenv('SECRET_CUSTOMERMANAGEMENT_DB_PASSWORD')\n\n#or let's say you want to fetch an API, but need an API token in a header request:\n....\n\nheader = { 'Api-Key' : os.getenv('SECRET_CUSTOMERMANAGEMENT_API_KEY') }\n....\n\n```\n\n**Kotlin:**\n\n```\nval envVar : String? = System.getenv(\"varname\")\n//there are some other examples feel free to look into https://stackoverflow.com/ but I like this approach because environment variables can be null, bus null handling probably comes down to your use-case/coding style.\n```\n\n## Authentication\n\n**AWS Server:**\n\nEasy!\nDone by boto3 automatically uses in instance role defined permissions.\n\n(Details \"Permissions\" section)\n\n**Developer:**\n\nboto3 uses the aws CLI's authentication so make sure you set this up before ;)\n\n[AWS CLI](https://aws.amazon.com/cli/)\n\nBy default, aenv uses the aws CLI default profile, but of course, you can choose the profile, that you want to use, simply do:\n\n```\naenv -p <awscli profile name>\n#or \naenv -h \n#to see more configuration options\n```\n\n(More details in the \"Usage\" section)\n\n**MFA**\n\nFirst of all multi-factor authentication is highly suggested!\n\nhttps://lmgtfy.com/?q=why+mfa+is+important\n\nOk, all jokes aside especially for production parameters your IAM users should require MFA authentication at least for production parameters.\n\nSo even when a password/account from one of your users gets compromised and let's be realistic here, this will definitely happen to your company/project so better prepare for that event!\n\n\"How can we mitigate the damage\" \n\nAt least in my humble opinion, this should be a \"better be safe than sorry\" point.\n\nEspecially for your production systems!\n\nAEnv supports multiple MFA options, details in the \"Usage\" section, here the short overview:\n\n```\n# normal virtual mfa token:\naenv -t <TOKEN>\n\n#askt for the token during runtime:\naenv -T\n\n# leads to:\n$ aenv -T\n$ Please enter token: \n\n#Yubikey Authenticator:\naenv -Y\n\n```\n\nAt the moment aws-CLI only supports virtual MFA devices(so the -Y option uses the virtual MFA function of your yubikey (ykman) as a workaround until awscli supports hardware tokens ), but feel free to drop a comment or investigate here:\n\nhttps://github.com/aws/aws-cli/issues/3607\n\n\n## Permissions: IAM policies / Instance roles\n\n| Permission | Used in the code | Documentation | Comment \n| :- | :- | :- | :-\n| \"ec2:DescribeTags\" | clientEC2.describe_tags() | https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeTags.html |\n| \"sts:GetCallerIdentity\" | clientSTS.get_caller_identity() | https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html | Optional(No permissions are required to perform this operation.)\n| \"sts:GetSessionToken\" | clientSTS.get_session_token() | https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html |\n| \"ssm:GetParametersByPath\" | clientSSMMFA.get_parameters_by_path() | https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-access.html |\n| \"iam:ListMFADevices\" | boto3.client('iam').list_mfa_devices() | https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_iam_mfa-selfmanage.html | Optional! (At the moment not in use but as soon aws API supports hardware tokens this can be enabled to let aenv support hardware MFA's) \n\n**tldr Minimal permissions:**\n\n\u201cec2:DescribeTags\u201d\n\n\u201csts:GetSessionToken\u201d\n\n\u201cssm:GetParametersByPath\u201d\n\n## Setup\n\n1. Define environment variables as described in **Format for these environment variables**\n2. Set environment tag's for your instances as described in **AWS Server**\n3. Create/adjust your instance roles/IAM roles with proper permissions as described in \n\n**Permissions**\n\n## Todo\n\n* introduce new pip package \"aenv\" (last update to https://pypi.org/project/credopy/) + and rework repo\n* Add better logo\n* Update and correct -h / --help output\n* Add regex filter for only loading specific variables\n* Add regex filter to leave out variables from loading\n* remove -q and add -v mode \n* Update initial setup instructions + consol output for this(ykman + output for missing service)\n* Option to list all available environments / services(discover/list env / list services)\n* Check for ykman on -Y calls improve output\n* get rid of environment detection and only rely on -e flag (also no default + better output for missing environment)\n* Currently only the fist MFA device of any given account is used -> add mfa device selection + option for default selection\n* cleanup/refactor documentation / improve overal structure\n* add only only auth mode\n* Add more information about container mode and necessary IAM permissions\n* Enhance local profile/config setup/usage\n* Load multiple services at once instead of concatenating multiple aenv calls ( \"aenv -s Service1 aenv -s Service2 \")\n* Load environment tags for ECS container / for task\n* Add testing\n* Add feature for only loading certain variables to speed up loading\n\n## Acknowledgments \n\n**Inspired by:**\n\n* **Gunnar Zarncke** - [LinkedIn](https://www.linkedin.com/in/gunnar-zarncke-952134163/) and his/troy gmbh's opensource credo projekt - [Git Credo](https://bitbucket.org/infomadis/troy-credo-aws/)\n\n**Bug reports:**\n\n* **[Arif PEHL\u0130VAN](https://github.com/mrpehlivan)** \n\n* **[Carlos Freund](https://github.com/happyherp)**\n\n## License\n\nMIT [Link](https://github.com/MartinWie/AEnv/blob/master/LICENSE)\n\n## Support me :heart: :star: :money_with_wings:\nIf this project provided value, and you want to give something back, you can give the repo a star or support by buying me a coffee.\n\n<a href=\"https://buymeacoffee.com/MartinWie\" target=\"_blank\"><img src=\"https://cdn.buymeacoffee.com/buttons/v2/default-blue.png\" alt=\"Buy Me A Coffee\" width=\"170\"></a>\n",
            "description_content_type": "text/markdown",
            "docs_url": null,
            "download_url": "https://github.com/MartinWie/AEnv/archive/2.0.0.tar.gz",
            "downloads": {
                "last_day": -1,
                "last_month": -1,
                "last_week": -1
            },
            "home_page": "https://github.com/MartinWie/AEnv",
            "keywords": "aws credo security parameterstore ssm cloud password aenv",
            "license": "MIT",
            "maintainer": "",
            "maintainer_email": "",
            "name": "aenv",
            "package_url": "https://pypi.org/project/aenv/",
            "platform": null,
            "project_url": "https://pypi.org/project/aenv/",
            "project_urls": {
                "Download": "https://github.com/MartinWie/AEnv/archive/2.0.0.tar.gz",
                "Homepage": "https://github.com/MartinWie/AEnv"
            },
            "release_url": "https://pypi.org/project/aenv/2.0.0/",
            "requires_dist": null,
            "requires_python": "",
            "summary": "A Python 3 tool to fetch secure strings from the aws parameter store and injecting those into environment variables.",
            "version": "2.0.0",
            "yanked": false,
            "yanked_reason": null
        },
        "last_serial": 15926340,
        "urls": [
            {
                "comment_text": "",
                "digests": {
                    "md5": "fe4838de20601aa0a412db07e8e60dd0",
                    "sha256": "e8cd6e18fb6bc80a5556bc1aa8b0d9e23c6e94620feb3ebef32dd6c7af54f38e"
                },
                "downloads": -1,
                "filename": "aenv-2.0.0.tar.gz",
                "has_sig": false,
                "md5_digest": "fe4838de20601aa0a412db07e8e60dd0",
                "packagetype": "sdist",
                "python_version": "source",
                "requires_python": null,
                "size": 18589,
                "upload_time": "2022-11-29T10:54:04",
                "upload_time_iso_8601": "2022-11-29T10:54:04.071018Z",
                "url": "https://files.pythonhosted.org/packages/b3/8f/a4e08c838b467dcf7a5ca6d6be6328d5c7bc4bb41f5f9e97646f2b817904/aenv-2.0.0.tar.gz",
                "yanked": false,
                "yanked_reason": null
            }
        ],
        "vulnerabilities": []
    }
}